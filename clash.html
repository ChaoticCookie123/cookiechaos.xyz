<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple JS Tower Defense Clone (Multi-Card)</title>
    
    <style>
        /* --- CSS Styling --- */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #333;
            font-family: 'Arial', sans-serif;
            flex-direction: column;
        }

        #game-container {
            border: 8px solid #a97e4b; /* Game border (Wood/Brown) */
            position: relative;
            background-color: #6a9c37; /* Field color (Green) */
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.6);
            border-radius: 10px;
        }

        #gameCanvas {
            display: block;
            background-image: linear-gradient(to bottom, #7b3d3d 10%, #6a9c37 10%, #6a9c37 90%, #3d3d7b 90%);
        }

        #ui-overlay {
            width: 100%;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 10px 0;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            position: absolute;
            bottom: 0;
            left: 0;
            box-sizing: border-box;
            border-top: 2px solid #555;
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 10px;
        }
        
        #ui-overlay p {
            margin: 0 10px;
            font-size: 1.1em;
            display: flex;
            align-items: center;
        }
        
        .icon {
            font-size: 1.5em;
            margin-right: 5px;
        }

        #card-deck {
            display: flex;
            gap: 10px;
        }
        
        .deploy-card {
            padding: 8px 10px;
            color: white;
            font-weight: bold;
            border: 3px solid #ffd700;
            cursor: pointer;
            border-radius: 8px;
            transition: background-color 0.2s;
            box-shadow: 0 4px #c43500;
            margin: 5px;
            min-width: 80px;
            text-align: center;
            line-height: 1.2;
        }
        
        .deploy-card:disabled {
            background-color: #555 !important;
            border-color: #333;
            cursor: not-allowed;
            box-shadow: none;
            color: #ccc;
        }
        
        .deploy-card:not(:disabled):active {
            box-shadow: 0 2px #c43500;
            transform: translateY(2px);
        }
        
        /* Specific Card Styles */
        #card0 { background-color: #007bff; } /* Blue/Knight */
        #card1 { background-color: #ff4500; } /* Red/Archer */
    </style>
</head>
<body>
    
    <h1>üëë Simple Tower Defense (Multi-Card)</h1>

    <div id="game-container">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        
        <div id="ui-overlay">
            <p><span class="icon">‚ù§Ô∏è</span> King Tower: <span id="playerHealth">2000</span></p>
            
            <div id="card-deck">
                </div>
            
            <p><span class="icon">üß™</span> Elixir: <span id="elixirCount">10</span>/10</p>
        </div>
    </div>

    <script>
        // --- Game Setup ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const GAME_WIDTH = canvas.width;
        const GAME_HEIGHT = canvas.height;

        // --- Game State Variables ---
        let playerHealth = 2000;
        let elixir = 10;
        let lastTime = 0;
        let elixirTimer = 0;
        let enemySpawnTimer = 0; 
        const ELIXIR_REGEN_RATE = 1; 
        const ENEMY_SPAWN_RATE = 4; // Enemy spawns every 4 seconds

        const gameObjects = []; 

        // --- CARD DEFINITION (NEW) ---
        class Card {
            constructor(name, cost, color, speed, damage, health) {
                this.name = name;
                this.cost = cost;
                this.color = color;
                this.speed = speed;
                this.damage = damage;
                this.health = health;
            }
        }

        const CARD_DECK = [
            new Card("Knight", 4, 'blue', 70, 80, 400),    // High Health, Medium Speed/Damage
            new Card("Archer", 2, 'red', 100, 30, 100)  // Low Cost/Health/Damage, High Speed
        ];

        // --- Game Object Classes ---

        class Unit {
            constructor(x, y, cardData, isPlayerUnit) {
                this.x = x;
                this.y = y;
                this.color = cardData.color;
                this.speed = cardData.speed; 
                this.damage = cardData.damage;
                this.health = cardData.health;
                this.maxHealth = cardData.health;
                this.width = 30;
                this.height = 30;
                this.isPlayerUnit = isPlayerUnit;
                this.isDead = false;
                this.attackCooldown = 1.0; 
                this.timeSinceLastAttack = 0;
            }

            draw() {
                // Main Body
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
                
                // Health Bar
                const healthRatio = this.health / this.maxHealth;
                ctx.fillStyle = healthRatio > 0.5 ? 'lime' : (healthRatio > 0.2 ? 'yellow' : 'red');
                ctx.fillRect(this.x, this.y - 10, this.width * healthRatio, 5);
                ctx.strokeStyle = 'black';
                ctx.strokeRect(this.x, this.y - 10, this.width, 5);
            }

            update(deltaTime) {
                if (this.health <= 0) {
                    this.isDead = true;
                    return;
                }
                
                this.timeSinceLastAttack += deltaTime;

                let target = findTarget(this);

                if (target) {
                    // Collision/Attack Range Check
                    if (checkCollision(this, target)) {
                        if (this.timeSinceLastAttack >= this.attackCooldown) {
                            attackTarget(this, target);
                            this.timeSinceLastAttack = 0;
                        }
                    } else {
                        // Move toward the target
                        const directionY = target.y - this.y;
                        const dirY = directionY > 0 ? 1 : -1;
                        this.y += dirY * this.speed * deltaTime;
                    }

                } else {
                    // Move towards the enemy King Tower
                    const kingTower = this.isPlayerUnit 
                        ? gameObjects.find(obj => obj instanceof Tower && obj.name === "Enemy King")
                        : gameObjects.find(obj => obj instanceof Tower && obj.name === "Your King");
                    
                    if (kingTower) {
                         const directionY = kingTower.y - this.y;
                         const dirY = directionY > 0 ? 1 : -1;
                         
                         if (Math.abs(directionY) > kingTower.height) { 
                             this.y += dirY * this.speed * deltaTime;
                         } else {
                             // Attack the tower
                             if (this.timeSinceLastAttack >= this.attackCooldown) {
                                attackTower(this, kingTower);
                                this.timeSinceLastAttack = 0;
                            }
                         }
                    }
                }
            }
        }

        class Tower {
            constructor(x, y, health, color, name) {
                this.x = x;
                this.y = y;
                this.health = health;
                this.maxHealth = health;
                this.color = color;
                this.name = name;
                this.width = 50;
                this.height = 80;
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
                
                // Tower Health Bar
                const healthRatio = this.health / this.maxHealth;
                ctx.fillStyle = 'white';
                ctx.fillRect(this.x, this.y - 15, this.width, 10);
                ctx.fillStyle = 'darkred';
                ctx.fillRect(this.x, this.y - 15, this.width * healthRatio, 10);
                ctx.strokeStyle = 'black';
                ctx.strokeRect(this.x, this.y - 15, this.width, 10);
            }
        }

        // --- Game Logic Functions ---
        
        function findTarget(unit) {
            let potentialTargets = gameObjects.filter(obj => 
                obj instanceof Unit && obj.isPlayerUnit !== unit.isPlayerUnit
            );
            return potentialTargets[0];
        }

        function checkCollision(unit1, unit2) {
            return unit1.x < unit2.x + unit2.width &&
                   unit1.x + unit1.width > unit2.x &&
                   unit1.y < unit2.y + unit2.height &&
                   unit1.y + unit1.height > unit2.y;
        }
        
        function attackTarget(attacker, defender) {
            defender.health -= attacker.damage;
        }

        function attackTower(attacker, tower) {
            tower.health -= attacker.damage;
            
            if (tower.name === "Your King") {
                // Update player UI health when enemy attacks player tower
                document.getElementById('playerHealth').textContent = Math.max(0, tower.health); 
            }
            
            if (tower.health <= 0) {
                alert(`${tower.name} destroyed! ${tower.name === "Your King" ? "Game Over! You Lose." : "Victory!"}`);
            }
        }

        // MODIFIED: Takes the index of the card to deploy
        function deployUnit(cardIndex) {
            const card = CARD_DECK[cardIndex];

            if (elixir >= card.cost) {
                elixir -= card.cost;
                
                // Player Unit (Bottom, uses card stats)
                const newUnit = new Unit(
                    GAME_WIDTH / 2 - 15, 
                    GAME_HEIGHT - 150,
                    card, // Pass the entire card data
                    true 
                );
                gameObjects.push(newUnit);
            } else {
                console.log(`Not enough Elixir to deploy ${card.name}!`);
            }
        }
        
        // Enemy units are now static (simplified)
        function spawnEnemyUnit() {
             const basicEnemyCard = { 
                 color: 'purple', 
                 speed: 70, 
                 damage: 60, 
                 health: 180 
             }; 
             
            const newEnemy = new Unit(
                GAME_WIDTH / 2 - 15, 
                130, // Spawn just below the enemy tower
                basicEnemyCard, 
                false // isPlayerUnit: false
            );
            gameObjects.push(newEnemy);
        }

        function updateElixir(deltaTime) {
            elixirTimer += deltaTime;
            if (elixirTimer >= 1) { 
                if (elixir < 10) {
                    elixir = Math.min(10, elixir + ELIXIR_REGEN_RATE);
                }
                elixirTimer = 0;
            }
            document.getElementById('elixirCount').textContent = Math.floor(elixir);
            
            // Update button status based on Elixir (NEW)
            updateCardButtons();
        }
        
        function updateEnemySpawn(deltaTime) {
            enemySpawnTimer += deltaTime;
            if (enemySpawnTimer >= ENEMY_SPAWN_RATE) {
                spawnEnemyUnit();
                enemySpawnTimer = 0;
            }
        }
        
        // NEW: Function to dynamically create card buttons
        function createCardButtons() {
            const cardDeckElement = document.getElementById('card-deck');
            
            CARD_DECK.forEach((card, index) => {
                const button = document.createElement('button');
                button.id = `card${index}`;
                button.className = 'deploy-card';
                button.onclick = () => deployUnit(index);
                button.innerHTML = `
                    ${card.name} <br> 
                    <span class="icon">üß™ ${card.cost}</span>
                `;
                cardDeckElement.appendChild(button);
            });
        }
        
        // NEW: Disable/Enable card buttons based on Elixir
        function updateCardButtons() {
            CARD_DECK.forEach((card, index) => {
                const button = document.getElementById(`card${index}`);
                if (button) {
                    button.disabled = elixir < card.cost;
                }
            });
        }
        
        function initGame() {
            // Setup Towers
            const opponentTower = new Tower(GAME_WIDTH / 2 - 25, 20, 2000, 'red', "Enemy King");
            const playerTower = new Tower(GAME_WIDTH / 2 - 25, GAME_HEIGHT - 100, 2000, 'blue', "Your King");
            gameObjects.push(opponentTower, playerTower);
            
            // Setup UI
            createCardButtons();
            updateCardButtons(); // Initial check
        }


        // --- Main Game Loop ---
        function gameLoop(timestamp) {
            const deltaTime = (timestamp - lastTime) / 1000;
            lastTime = timestamp;

            // 1. Clear the canvas
            ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);

            // 2. Update Game State
            updateElixir(deltaTime);
            updateEnemySpawn(deltaTime); 
            
            // Update all game objects 
            for (let i = gameObjects.length - 1; i >= 0; i--) {
                const obj = gameObjects[i];
                if (obj instanceof Unit) {
                    obj.update(deltaTime);
                    if (obj.isDead) {
                        gameObjects.splice(i, 1); // Remove dead units
                    }
                }
            }

            // 3. Draw Objects
            ctx.fillStyle = '#4c5d88'; 
            ctx.fillRect(0, GAME_HEIGHT / 2 - 5, GAME_WIDTH, 10);

            for (const obj of gameObjects) {
                obj.draw();
            }
            
            requestAnimationFrame(gameLoop);
        }

        // Start the game!
        initGame();
        requestAnimationFrame(gameLoop);
    </script>
</body>
</html>
