<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clash Royale JS Clone - Drag & Drop</title>
    
    <style>
        /* --- CSS STYLES --- */
        :root {
            --arena-color: #38761D; /* Dark Green */
            --river-color: #4A86E8; /* Blue */
            --border-color: #6AA84F; /* Lighter Green */
            --hand-bg-color: #333;
            --card-color: #8E7CC3; /* Purple/Gray */
        }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #222;
        }

        #game-container {
            width: 600px; 
            height: 900px; 
            border: 5px solid #000;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        /* --- ARENA --- */

        #arena {
            flex-grow: 1;
            background-color: var(--arena-color);
            position: relative;
            border-top: 5px solid var(--river-color);
            border-bottom: 5px solid var(--river-color);
        }

        .side {
            height: 100px; 
            background-color: var(--arena-color);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 10px;
        }

        #opponent-side { border-bottom: 5px solid var(--river-color); }
        #player-side { border-top: 5px solid var(--river-color); }

        .tower, .king-tower {
            font-size: 40px;
            width: 80px;
            height: 80px;
            background-color: #ccc;
            border: 3px solid #000;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: default;
        }

        /* River and Bridges */
        #arena::before {
            content: '';
            position: absolute;
            top: calc(50% - 5px); 
            left: 0;
            right: 0;
            height: 10px;
            background-color: var(--river-color);
            z-index: 1;
        }

        .bridge {
            position: absolute;
            width: 40px;
            height: 10px;
            background-color: #996633; 
            z-index: 2;
            top: calc(50% - 5px);
        }
        #bridge-1 { left: 150px; }
        #bridge-2 { right: 150px; }

        /* --- UI --- */

        #game-ui {
            height: 120px;
            background-color: var(--hand-bg-color);
            display: flex;
            align-items: center;
            padding: 10px;
            box-sizing: border-box;
            border-top: 5px solid #000;
        }

        #elixir-bar {
            background-color: #FFC000; 
            color: #000;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 20px;
            width: 80px;
            text-align: center;
            margin-right: 20px;
        }

        #card-hand {
            display: flex;
            gap: 10px;
        }

        .card {
            width: 80px;
            height: 100px;
            background-color: var(--card-color);
            border: 4px solid #fff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
            cursor: grab; /* Changed to grab */
            transition: transform 0.1s;
            font-family: sans-serif;
            user-select: none;
            position: relative; 
            z-index: 50; /* Ensure card is above arena elements */
        }

        .card.dragging {
            opacity: 0.7;
            border: 4px solid yellow; /* Visual feedback for dragging */
        }

        .card:hover {
            transform: translateY(-5px);
        }
        /* Style for cards that cannot be played (not enough elixir) */
        .card.disabled {
            filter: grayscale(100%);
            opacity: 0.5;
            cursor: default;
        }

        .card-emoji {
            font-size: 36px;
        }

        .card-cost {
            background-color: blue;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 14px;
            line-height: 20px;
            text-align: center;
            position: absolute;
            top: -10px;
            right: -10px;
            border: 2px solid #fff;
        }

        /* Troop Styling */
        .troop {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            transition: all 5s linear; 
            z-index: 10;
        }
        .player-troop { background-color: #008000; border: 2px solid #000; }
        .opponent-troop { background-color: #FF0000; border: 2px solid #000; }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="opponent-side" class="side">
            <div id="opponent-left-tower" class="tower">üè∞</div>
            <div id="opponent-king-tower" class="king-tower">üëë</div>
            <div id="opponent-right-tower" class="tower">üè∞</div>
        </div>

        <div id="arena">
            <div id="bridge-1" class="bridge"></div>
            <div id="bridge-2" class="bridge"></div>
        </div>

        <div id="player-side" class="side">
            <div id="player-left-tower" class="tower">üè∞</div>
            <div id="player-king-tower" class="king-tower">üëë</div>
            <div id="player-right-tower" class="tower">üè∞</div>
        </div>

        <div id="game-ui">
            <div id="elixir-bar">
                <span id="elixir-count">0</span> / 10
            </div>
            <div id="card-hand">
                </div>
        </div>
    </div>

    <script>
        // --- JAVASCRIPT LOGIC ---

        // --- 1. GAME CONSTANTS AND DATA ---
        const CARD_DEFINITIONS = [
            { name: "Knight", cost: 3, emoji: "üõ°Ô∏è", type: "troop" },
            { name: "Archers", cost: 3, emoji: "üèπ", type: "troop" },
            { name: "Giant", cost: 5, emoji: "üóø", type: "troop" },
            { name: "Fireball", cost: 4, emoji: "üî•", type: "spell" },
            { name: "Goblin Barrel", cost: 3, emoji: "üì¶", type: "spell" },
            { name: "Mini P.E.K.K.A", cost: 4, emoji: "ü§ñ", type: "troop" },
            { name: "Musketeer", cost: 4, emoji: "üî´", type: "troop" },
            { name: "Valkyrie", cost: 4, emoji: "ü™ì", type: "troop" },
        ];

        const HAND_SIZE = 4;
        let playerElixir = 5;
        let playerHand = [];
        let currentlyDraggedCardIndex = -1;

        // --- 2. DOM ELEMENTS ---
        const arena = document.getElementById('arena');
        const gameContainer = document.getElementById('game-container');
        const cardHandDiv = document.getElementById('card-hand');
        const elixirCountSpan = document.getElementById('elixir-count');
        const arenaRect = arena.getBoundingClientRect();

        // --- 3. HELPER FUNCTIONS ---

        /** Draws a card from the definition list and adds it to the hand. */
        function drawCard() {
            if (playerHand.length >= HAND_SIZE) return;
            const randomIndex = Math.floor(Math.random() * CARD_DEFINITIONS.length);
            const newCard = { ...CARD_DEFINITIONS[randomIndex] }; 
            playerHand.push(newCard);
            renderHand();
        }

        /** Updates the Elixir count on the UI and checks which cards can be played. */
        function updateElixirUI() {
            elixirCountSpan.textContent = playerElixir;
            
            // Check card playability
            document.querySelectorAll('.card').forEach(cardElement => {
                const index = parseInt(cardElement.getAttribute('data-card-index'));
                const cost = playerHand[index]?.cost || 99; // Get cost, default high if error
                
                if (playerElixir < cost) {
                    cardElement.classList.add('disabled');
                    cardElement.setAttribute('draggable', 'false');
                } else {
                    cardElement.classList.remove('disabled');
                    cardElement.setAttribute('draggable', 'true');
                }
            });
        }

        /** Renders the player's current hand and attaches event listeners. */
        function renderHand() {
            cardHandDiv.innerHTML = '';
            playerHand.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card';
                cardElement.setAttribute('data-card-index', index);
                cardElement.setAttribute('draggable', 'true');
                cardElement.innerHTML = `
                    <span class="card-emoji">${card.emoji}</span>
                    <div class="card-cost">${card.cost}</div>
                `;
                
                // --- DRAG AND DROP LISTENERS ---
                cardElement.addEventListener('dragstart', handleDragStart);
                cardElement.addEventListener('dragend', handleDragEnd);

                cardHandDiv.appendChild(cardElement);
            });
            updateElixirUI(); // Apply the disabled class immediately
        }

        // --- 4. DRAG AND DROP HANDLERS ---
        
        function handleDragStart(e) {
            const cardElement = e.target.closest('.card');
            if (!cardElement || cardElement.classList.contains('disabled')) {
                e.preventDefault(); // Prevent drag if disabled
                return;
            }

            currentlyDraggedCardIndex = parseInt(cardElement.getAttribute('data-card-index'));
            cardElement.classList.add('dragging');
            // DataTransfer: Only used for drag visualization and to allow the drag event to fire
            e.dataTransfer.setData('text/plain', currentlyDraggedCardIndex); 
            e.dataTransfer.effectAllowed = 'copy';
        }

        function handleDragEnd(e) {
            const cardElement = e.target.closest('.card');
            if (cardElement) {
                 cardElement.classList.remove('dragging');
            }
            
            // If drop was successful, the card has already been removed from the hand
            currentlyDraggedCardIndex = -1;
        }
        
        // This is the main target area for the dropped card
        arena.addEventListener('dragover', (e) => {
            e.preventDefault(); // Necessary to allow dropping
            e.dataTransfer.dropEffect = 'copy';
        });

        arena.addEventListener('drop', (e) => {
            e.preventDefault();
            
            if (currentlyDraggedCardIndex === -1) return; // Should not happen if dragstart worked
            
            // Get coordinates relative to the ARENA (the drop target)
            const rect = arena.getBoundingClientRect();
            const arenaX = e.clientX - rect.left;
            const arenaY = e.clientY - rect.top;
            
            // --- Enforcement of Player's Territory (Bottom Half) ---
            const arenaHeight = rect.height;
            // Player's deployment zone is the bottom half (Y > 50% of arena height)
            const deploymentYThreshold = arenaHeight * 0.5; 

            if (arenaY < deploymentYThreshold) {
                console.log("Cannot deploy card that high! Must be in your territory (bottom half).");
                return; // Prevent play if dropped too high
            }
            
            // Play the card at the calculated coordinates
            handleCardPlay(currentlyDraggedCardIndex, arenaX, arenaY);
        });


        // --- 5. GAME MECHANICS ---

        /** * Handles the action of a player attempting to play a card. 
         * @param {number} cardIndex - Index of the card in the playerHand array.
         * @param {number} x - X coordinate relative to the arena.
         * @param {number} y - Y coordinate relative to the arena.
         */
        function handleCardPlay(cardIndex, x, y) {
            const card = playerHand[cardIndex];
            
            if (playerElixir >= card.cost) {
                if (card.type === 'troop') {
                    spawnTroop('player', card, x, y); 
                } else if (card.type === 'spell') {
                    showSpellEffect(card, x, y);
                }
                
                playerElixir -= card.cost;
                playerHand.splice(cardIndex, 1); // Remove card from hand
                drawCard(); // Draw a replacement card
                updateElixirUI();
            } else {
                // This message should technically be suppressed by the 'disabled' class logic, 
                // but included here for safety/debugging.
                console.log("Not enough elixir to play " + card.name); 
            }
        }
        
        /** Shows a simple flash for spell cards. */
        function showSpellEffect(card, x, y) {
            const spellEffect = document.createElement('div');
            spellEffect.className = 'spell-effect';
            spellEffect.textContent = card.emoji;
            spellEffect.style.position = 'absolute';
            spellEffect.style.left = `${x - 25}px`;
            spellEffect.style.top = `${y - 25}px`;
            spellEffect.style.fontSize = '60px';
            spellEffect.style.opacity = 1;
            spellEffect.style.transition = 'opacity 0.3s ease-out';
            arena.appendChild(spellEffect);

            // Quick fade out
            setTimeout(() => {
                spellEffect.style.opacity = 0;
            }, 100);

            // Remove after fade
            setTimeout(() => {
                spellEffect.remove();
            }, 400);
        }

        /** Creates and places a troop on the arena. */
        function spawnTroop(side, card, x, y) {
            const troop = document.createElement('div');
            troop.className = `troop ${side}-troop`;
            troop.textContent = card.emoji;
            
            // Position the troop (x, y are relative to arena top-left)
            troop.style.left = `${x - 15}px`; // Center X
            troop.style.top = `${y - 15}px`; // Center Y
            
            arena.appendChild(troop);

            // Determine target location (simplified: move straight to the opposite side)
            const targetY = (side === 'player' ? 100 : arena.offsetHeight * 0.8); 
            const targetX = x; // Troop maintains its current lane/X position (simple movement)

            // Apply movement after a tiny delay for visual placement
            setTimeout(() => {
                troop.style.top = `${targetY}px`;
                troop.style.left = `${targetX - 15}px`; // Adjust target X for centering
            }, 50);

            // Remove the troop after movement duration
            setTimeout(() => {
                troop.remove();
            }, 5000); 
        }

        // --- 6. GAME LOOPS (Elixir and AI) ---

        /** Elixir Generation Loop */
        function elixirLoop() {
            setInterval(() => {
                if (playerElixir < 10) {
                    playerElixir = Math.min(10, playerElixir + 1);
                    updateElixirUI();
                }
            }, 1000); // Generates 1 elixir every 1 second
        }

        /** Simple Opponent AI */
        function opponentAiLoop() {
            setInterval(() => {
                const troopCards = CARD_DEFINITIONS.filter(c => c.type === 'troop' && c.cost <= 5);
                
                // Randomly choose one lane to attack (left or right)
                const isLeftLane = Math.random() < 0.5;
                const spawnX = isLeftLane ? 200 : 400; // Left or Right lane X coordinate
                const spawnY = arena.offsetHeight * 0.2; // 20% down the arena (Opponent's territory)

                if (troopCards.length > 0) {
                    const cardToPlay = troopCards[Math.floor(Math.random() * troopCards.length)];
                    
                    // 40% chance to play a card every 3 seconds
                    if (Math.random() > 0.6) { 
                        spawnTroop('opponent', cardToPlay, spawnX, spawnY);
                    }
                }
            }, 3000); 
        }


        // --- 7. INITIALIZATION ---

        function initGame() {
            // Start with a full hand
            for(let i = 0; i < HAND_SIZE; i++) {
                drawCard();
            }

            elixirLoop();
            opponentAiLoop(); 
            
            console.log("Clash Clone Initialized! Drag and drop cards onto the bottom half of the arena to play them.");
        }

        window.onload = initGame;
    </script>
</body>
</html>
